<!--
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouvement au Clavier</title>
    <link href="/css/tailwind.css" rel="stylesheet">
    &lt;!&ndash; <script src="https://cdn.tailwindcss.com"></script> &ndash;&gt;
    <link rel="stylesheet" href="/css/output.css">
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
    <style>
        html, body, #app {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
    </style>

</head>
<body class="overflow-hidden h-screen bg-black">
<div id="app" class="p-0">
    &lt;!&ndash; Le contenu des pages sera charg√© ici &ndash;&gt;
</div>

<script type="module" src="/public/router.js"></script>


</body>
</html>-->

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcendance - Test API Complet</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        h1, h2 {
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select, button {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        input, select {
            width: 200px;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .success {
            color: #28a745;
            font-weight: bold;
        }

        .error {
            color: #dc3545;
            font-weight: bold;
        }

        .invitation-item, .friend-item {
            background: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }

        .pending {
            border-left-color: #ffc107;
        }

        .accepted {
            border-left-color: #28a745;
        }

        .response {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }

        .user-list {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .user-card {
            background: #e9ecef;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
<h1>üéÆ Transcendance - Test API Complet</h1>

<!-- Configuration -->
<div class="container">
    <h2>‚öôÔ∏è Configuration</h2>
    <div class="form-group">
        <label for="apiUrl">URL de l'API:</label>
        <input type="text" id="apiUrl" value="http://localhost:8443">
    </div>
    <div class="form-group">
        <label for="currentUserId">ID Utilisateur Actuel:</label>
        <input type="text" id="currentUserId" value="user1" placeholder="ex: user1">
    </div>
</div>

<!-- Cr√©er des utilisateurs -->
<div class="container">
    <h2>üë§ Cr√©er des Utilisateurs</h2>
    <div class="form-group">
        <label for="newUserId">ID Utilisateur:</label>
        <input type="text" id="newUserId" placeholder="ex: user5">
    </div>
    <div class="form-group">
        <label for="newUsername">Nom d'utilisateur:</label>
        <input type="text" id="newUsername" placeholder="ex: Emma">
    </div>
    <button onclick="createUser()">Cr√©er l'utilisateur</button>
    <button onclick="createTestUsers()">Cr√©er utilisateurs de test</button>
    <div id="createUserResponse" class="response"></div>

    <div id="usersList" class="user-list"></div>
</div>

<!-- Envoyer une invitation -->
<div class="container">
    <h2>üì§ Envoyer une Invitation</h2>
    <div class="form-group">
        <label for="inviteUserId">ID de l'utilisateur √† inviter:</label>
        <input type="text" id="inviteUserId" placeholder="ex: user2">
    </div>
    <button onclick="sendInvitation()">Envoyer l'invitation</button>
    <div id="inviteResponse" class="response"></div>
</div>

<!-- Voir les invitations re√ßues -->
<div class="container">
    <h2>üì• Invitations Re√ßues</h2>
    <button onclick="loadInvitations()">Charger les invitations</button>
    <div id="invitationsList"></div>
    <div id="invitationsResponse" class="response"></div>
</div>

<!-- G√©rer les invitations -->
<div class="container">
    <h2>‚úÖ G√©rer les Invitations</h2>
    <div class="form-group">
        <label for="requesterIdAccept">ID du demandeur:</label>
        <input type="text" id="requesterIdAccept" placeholder="ex: user3">
    </div>
    <button onclick="acceptInvitation()">Accepter</button>
    <button onclick="declineInvitation()" style="background-color: #dc3545;">Refuser</button>
    <div id="manageResponse" class="response"></div>
</div>

<!-- Liste des amis -->
<div class="container">
    <h2>üë• Liste des Amis</h2>
    <button onclick="loadFriends()">Charger les amis</button>
    <div id="friendsList"></div>
    <div id="friendsResponse" class="response"></div>
</div>

<!-- Outils de test -->
<div class="container">
    <h2>üß™ Outils de Test</h2>
    <button onclick="clearResponses()" style="background-color: #6c757d;">Effacer les r√©ponses</button>
    <button onclick="testAllRoutes()" style="background-color: #17a2b8;">Tester toutes les routes</button>
    <div id="testResponse" class="response"></div>
</div>

<script>
    // Get API base URL
    function getApiUrl() {
        return document.getElementById('apiUrl').value;
    }

    console.log(getApiUrl());

    // Get current user ID
    function getCurrentUserId() {
        return document.getElementById('currentUserId').value;
    }

    // Display response in a container
    function displayResponse(containerId, response, isError = false) {
        const container = document.getElementById(containerId);
        container.textContent = JSON.stringify(response, null, 2);
        container.className = `response ${isError ? 'error' : 'success'}`;
    }

    // Create a single user
    async function createUser() {
        const apiUrl = getApiUrl();
        const userId = document.getElementById('newUserId').value;
        const username = document.getElementById('newUsername').value;

        if (!userId || !username) {
            alert('Please enter both user ID and username');
            return;
        }

        try {
            const response = await fetch(`${apiUrl}/api/users/create`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    userId: userId,
                    username: username
                })
            });

            const data = await response.json();
            displayResponse('createUserResponse', data, !response.ok);

            // Clear form
            document.getElementById('newUserId').value = '';
            document.getElementById('newUsername').value = '';

            // Refresh user list
            updateUsersList();
        } catch (error) {
            displayResponse('createUserResponse', { error: error.message }, true);
        }
    }

    // Create test users
    async function createTestUsers() {
        const testUsers = [
            { userId: 'user1', username: 'Alice' },
            { userId: 'user2', username: 'Bob' },
            { userId: 'user3', username: 'Charlie' },
            { userId: 'user4', username: 'Diana' }
        ];

        const results = [];
        const apiUrl = getApiUrl();

        for (const user of testUsers) {
            try {
                const response = await fetch(`${apiUrl}/api/users/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(user)
                });

                const data = await response.json();
                results.push({ user: user.username, result: data });
            } catch (error) {
                results.push({ user: user.username, error: error.message });
            }
        }

        displayResponse('createUserResponse', {
            message: 'Test users creation attempted',
            results: results
        });

        updateUsersList();
    }

    // Update users list display
    function updateUsersList() {
        const usersList = document.getElementById('usersList');
        const testUsers = ['user1 (Alice)', 'user2 (Bob)', 'user3 (Charlie)', 'user4 (Diana)'];

        usersList.innerHTML = testUsers.map(user =>
            `<div class="user-card">${user}</div>`
        ).join('');
    }

    // Send friend invitation
    async function sendInvitation() {
        const apiUrl = getApiUrl();
        const currentUserId = getCurrentUserId();
        console.log(currentUserId);
        const addresseeId = document.getElementById('inviteUserId').value;
        console.log(addresseeId);

        if (!addresseeId) {
            alert('Please enter a user ID to invite');
            return;
        }

        try {
            const response = await fetch(`${apiUrl}/api/users/${currentUserId}/invite`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'user-id': currentUserId
                },
                body: JSON.stringify({
                    addressee_id: addresseeId
                })
            });

            const data = await response.json();
            displayResponse('inviteResponse', data, !response.ok);
        } catch (error) {
            displayResponse('inviteResponse', { error: error.message }, true);
        }
    }

    // Load pending invitations
    async function loadInvitations() {
        const apiUrl = getApiUrl();
        const currentUserId = getCurrentUserId();

        try {
            const response = await fetch(`${apiUrl}/api/users/${currentUserId}/invitations`, {
                headers: {
                    'user-id': currentUserId
                }
            });

            const data = await response.json();
            displayResponse('invitationsResponse', data, !response.ok);

            // Display invitations in a nice format
            const invitationsList = document.getElementById('invitationsList');
            if (data.invitations && data.invitations.length > 0) {
                invitationsList.innerHTML = data.invitations.map(inv => `
                    <div class="invitation-item pending">
                        <strong>${inv.username}</strong> (${inv.requester_id})
                        <br>Status: ${inv.status}
                        <br>Avatar: ${inv.avatar_url || 'N/A'}
                    </div>
                `).join('');
            } else {
                invitationsList.innerHTML = '<p>Aucune invitation en attente</p>';
            }
        } catch (error) {
            displayResponse('invitationsResponse', { error: error.message }, true);
        }
    }

    // Accept invitation
    async function acceptInvitation() {
        const apiUrl = getApiUrl();
        const requesterId = document.getElementById('requesterIdAccept').value;

        if (!requesterId) {
            alert('Please enter the requester ID');
            return;
        }

        try {
            const response = await fetch(`${apiUrl}/api/invitations/${requesterId}/accept`, {
                method: 'PUT',
                headers: {
                    'user-id': getCurrentUserId()
                }
            });

            const data = await response.json();
            displayResponse('manageResponse', data, !response.ok);
        } catch (error) {
            displayResponse('manageResponse', { error: error.message }, true);
        }
    }

    // Decline invitation
    async function declineInvitation() {
        const apiUrl = getApiUrl();
        const requesterId = document.getElementById('requesterIdAccept').value;

        if (!requesterId) {
            alert('Please enter the requester ID');
            return;
        }

        try {
            const response = await fetch(`${apiUrl}/api/invitations/${requesterId}/decline`, {
                method: 'DELETE',
                headers: {
                    'user-id': getCurrentUserId()
                }
            });

            const data = await response.json();
            displayResponse('manageResponse', data, !response.ok);
        } catch (error) {
            displayResponse('manageResponse', { error: error.message }, true);
        }
    }

    // Load friends list
    async function loadFriends() {
        const apiUrl = getApiUrl();
        const currentUserId = getCurrentUserId();

        try {
            const response = await fetch(`${apiUrl}/api/users/${currentUserId}/friends`, {
                headers: {
                    'user-id': currentUserId
                }
            });

            const data = await response.json();
            displayResponse('friendsResponse', data, !response.ok);

            // Display friends in a nice format
            const friendsList = document.getElementById('friendsList');
            if (data.friends && data.friends.length > 0) {
                friendsList.innerHTML = data.friends.map(friend => `
                    <div class="friend-item accepted">
                        <strong>${friend.username}</strong> (${friend.id})
                        <br>Status: ${friend.status || 'online'}
                        <br>Avatar: ${friend.avatar_url || 'N/A'}
                    </div>
                `).join('');
            } else {
                friendsList.innerHTML = '<p>Aucun ami pour le moment</p>';
            }
        } catch (error) {
            displayResponse('friendsResponse', { error: error.message }, true);
        }
    }

    // Test all routes sequentially
    async function testAllRoutes() {
        const testResults = [];

        try {
            // Test 1: Create users
            testResults.push("=== Testing user creation ===");
            await createTestUsers();
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Test 2: Send invitation
            testResults.push("=== Testing invitation sending ===");
            document.getElementById('inviteUserId').value = 'user2';
            await sendInvitation();
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Test 3: Load invitations
            testResults.push("=== Testing invitations loading ===");
            document.getElementById('currentUserId').value = 'user2';
            await loadInvitations();
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Test 4: Accept invitation
            testResults.push("=== Testing invitation acceptance ===");
            document.getElementById('requesterIdAccept').value = 'user1';
            await acceptInvitation();
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Test 5: Load friends
            testResults.push("=== Testing friends loading ===");
            await loadFriends();

            displayResponse('testResponse', {
                message: 'All routes tested successfully',
                tests: testResults
            });

        } catch (error) {
            displayResponse('testResponse', {
                error: 'Error during testing',
                details: error.message
            }, true);
        }
    }

    // Clear all response containers
    function clearResponses() {
        const responseContainers = [
            'createUserResponse', 'inviteResponse', 'invitationsResponse',
            'manageResponse', 'friendsResponse', 'testResponse'
        ];

        responseContainers.forEach(id => {
            const container = document.getElementById(id);
            container.textContent = '';
            container.className = 'response';
        });

        // Clear lists
        document.getElementById('invitationsList').innerHTML = '';
        document.getElementById('friendsList').innerHTML = '';
        document.getElementById('usersList').innerHTML = '';
    }

    // Load initial data on page load
    window.addEventListener('load', () => {
        console.log('üéÆ Transcendance API Tester loaded');
        console.log('Make sure your Fastify server is running on the configured URL');
        updateUsersList();
    });
</script>
</body>
</html>
